<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditor Assistido Savegnago</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f1f5f9; height: 100vh; overflow: hidden; }
        .scroll-area { overflow-y: auto; height: calc(100vh - 180px); }
        .product-row { transition: all 0.2s; cursor: pointer; border-left: 4px solid transparent; }
        .product-row:hover { background-color: #f8fafc; }
        .product-row.checked { background-color: #dcfce7; border-left-color: #166534; opacity: 0.7; }
        .product-row.checked .status-icon { color: #166534; }
        .img-card { transition: transform 0.2s; }
        .img-card:hover { transform: scale(1.02); z-index: 10; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="flex flex-col">

    <header class="bg-blue-800 text-white p-4 shadow-md flex justify-between items-center h-16 shrink-0">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-list-check text-2xl"></i>
            <div>
                <h1 class="font-bold text-lg leading-tight">Auditor Assistido</h1>
                <p class="text-xs text-blue-200">Ferramenta de Conferência Visual Rápida</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="document.getElementById('setupModal').classList.remove('hidden')" class="bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded text-sm"><i class="fa-solid fa-gear mr-1"></i> Configurar</button>
            <button onclick="window.location.reload()" class="bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded text-sm"><i class="fa-solid fa-rotate-right"></i> Reset</button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <div class="w-1/3 bg-white border-r border-gray-200 flex flex-col">
            <div class="p-3 bg-gray-50 border-b border-gray-200 font-bold text-gray-600 flex justify-between items-center">
                <span><i class="fa-solid fa-clipboard-list mr-2"></i>Lista de Ofertas</span>
                <span id="progressCount" class="text-xs bg-gray-200 px-2 py-1 rounded">0/0</span>
            </div>
            <div id="checklistArea" class="scroll-area p-2 space-y-2">
                <div class="text-center text-gray-400 mt-10 p-4">
                    <i class="fa-solid fa-arrow-up text-2xl mb-2"></i><br>
                    Clique em "Configurar" para colar a lista e o HTML.
                </div>
            </div>
            <div class="p-3 border-t border-gray-200 bg-gray-50">
                <textarea id="cleanOutput" class="w-full h-20 text-[10px] p-2 border rounded font-mono text-gray-500" readonly placeholder="A lista corrigida aparecerá aqui para você copiar..."></textarea>
                <button onclick="copyClean()" class="w-full mt-1 bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs py-1 rounded">Copiar Lista Corrigida</button>
            </div>
        </div>

        <div class="w-2/3 bg-slate-100 flex flex-col">
            <div class="p-3 bg-white border-b border-gray-200 font-bold text-gray-600 shadow-sm">
                <i class="fa-solid fa-images mr-2"></i>Imagens do E-mail
            </div>
            <div id="galleryArea" class="scroll-area p-6 grid grid-cols-2 md:grid-cols-3 gap-6 overflow-y-auto content-start">
                </div>
        </div>
    </div>

    <div id="setupModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[80vh] flex flex-col">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-xl font-bold text-gray-800">Carregar Dados</h2>
                <button onclick="document.getElementById('setupModal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="flex-1 p-6 grid grid-cols-2 gap-6 overflow-hidden">
                <div class="flex flex-col h-full">
                    <label class="font-bold text-gray-700 mb-2">1. Cole a Lista de Texto</label>
                    <textarea id="rawList" class="flex-1 p-4 border rounded-lg bg-gray-50 text-xs font-mono resize-none focus:ring-2 focus:ring-blue-500" placeholder="Arroz - R$ 10,90..."></textarea>
                </div>
                <div class="flex flex-col h-full">
                    <label class="font-bold text-gray-700 mb-2">2. Cole o HTML do E-mail</label>
                    <textarea id="rawHtml" class="flex-1 p-4 border rounded-lg bg-gray-50 text-xs font-mono resize-none focus:ring-2 focus:ring-blue-500" placeholder="<!DOCTYPE html>..."></textarea>
                </div>
            </div>

            <div class="p-6 border-t bg-gray-50 flex justify-end">
                <button onclick="startAudit()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2">
                    <i class="fa-solid fa-play"></i> Iniciar Conferência
                </button>
            </div>
        </div>
    </div>

    <script>
        const CORRECTIONS = {
            'btata': 'batata', 'tomati': 'tomate', 'repolhu': 'repolho', 'cenora': 'cenoura', 
            'melao': 'melão', 'limao': 'limão', 'mamao': 'mamão', 'pera': 'pêra', 'maca': 'maçã', 
            'acucar': 'açúcar', 'importad': 'importado', 'brocolis': 'brócolis', 
            'kilo': 'kg', 'kilograma': 'kg', 'nessa': 'nesta', 'promoção': 'oferta', 
            'val': 'validade', 'venc': 'vencimento', 'sbp': 'SBP', 'off': 'OFF', 'on': 'ON', 
            '1l': '1L', '2l': '2L', '2,5l': '2,5L', '3l': '3L', '5l': '5L', 'unidade': 'un'
        };

        function cleanText(text) {
            let corrected = text;
            for (const [wrong, right] of Object.entries(CORRECTIONS)) {
                const regex = new RegExp(`\\b${wrong}\\b`, 'gi');
                corrected = corrected.replace(regex, (match) => {
                    if(['SBP','OFF','ON','1L','2L','3L','5L','kg'].includes(right)) return right;
                    return match[0] === match[0].toUpperCase() ? right.charAt(0).toUpperCase() + right.slice(1) : right;
                });
            }
            return corrected;
        }

        function startAudit() {
            const listTxt = document.getElementById('rawList').value;
            const htmlTxt = document.getElementById('rawHtml').value;
            
            if(!listTxt || !htmlTxt) return alert("Preencha os dois campos!");

            // 1. Processar Lista
            const cleanList = cleanText(listTxt);
            document.getElementById('cleanOutput').value = cleanList;
            
            const listContainer = document.getElementById('checklistArea');
            listContainer.innerHTML = '';
            
            const lines = cleanList.split('\n');
            let totalItems = 0;

            lines.forEach((line, idx) => {
                if(!line.trim()) return;
                
                // Regex simples para identificar linha de produto
                const isProduct = line.includes('R$');
                const isDetail = line.trim().startsWith('(');
                
                let html = '';
                if(isProduct && !isDetail) {
                    totalItems++;
                    html = `
                        <div class="product-row p-3 bg-white border rounded shadow-sm flex items-start gap-3" onclick="this.classList.toggle('checked'); updateCount()">
                            <div class="mt-1 text-gray-300 status-icon"><i class="fa-solid fa-circle-check text-xl"></i></div>
                            <div>
                                <div class="text-sm font-bold text-gray-800">${line}</div>
                            </div>
                        </div>
                    `;
                } else {
                    // Linha de detalhe (cartão) anexa ao anterior visualmente
                    html = `<div class="ml-10 text-xs text-blue-600 font-mono mb-2">${line}</div>`;
                }
                listContainer.innerHTML += html;
            });
            
            document.getElementById('progressCount').innerText = `0/${totalItems}`;

            // 2. Processar Imagens
            const gallery = document.getElementById('galleryArea');
            gallery.innerHTML = '';
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlTxt, 'text/html');
            const imgs = Array.from(doc.querySelectorAll('img'))
                .map(i => i.src)
                .filter(s => s && !s.match(/pixel|icon|social|header|footer/i));
            
            const uniqueImgs = [...new Set(imgs)];
            
            uniqueImgs.forEach(src => {
                gallery.innerHTML += `
                    <div class="img-card bg-white p-2 rounded shadow border border-gray-200">
                        <img src="${src}" class="w-full h-auto object-contain bg-gray-50 rounded" loading="lazy" onerror="this.src='https://placehold.co/200x200?text=Erro+Imagem'">
                        <div class="mt-2 text-[10px] text-gray-400 truncate text-center">${src.split('/').pop()}</div>
                    </div>
                `;
            });

            document.getElementById('setupModal').classList.add('hidden');
        }

        function updateCount() {
            const total = document.querySelectorAll('.product-row').length;
            const checked = document.querySelectorAll('.product-row.checked').length;
            document.getElementById('progressCount').innerText = `${checked}/${total}`;
        }

        function copyClean() {
            const el = document.getElementById('cleanOutput');
            el.select();
            document.execCommand('copy');
            alert("Lista corrigida copiada!");
        }
    </script>
</body>
</html>
